# RESTful API è§„èŒƒåˆ†ææŠ¥å‘Š

## ğŸ“‹ å½“å‰ API è®¾è®¡è¯„ä¼°

### âœ… ç¬¦åˆ RESTful è§„èŒƒçš„éƒ¨åˆ†

#### 1. èµ„æºå‘½åï¼ˆResource Namingï¼‰
- âœ… ä½¿ç”¨å¤æ•°åè¯ï¼š`/domains`, `/configs`
- âœ… ä½¿ç”¨å°å†™å­—æ¯
- âœ… ä½¿ç”¨è¿å­—ç¬¦åˆ†éš”ï¼ˆå¦‚æœéœ€è¦ï¼‰
- âœ… èµ„æºå±‚æ¬¡æ¸…æ™°

#### 2. HTTP æ–¹æ³•ä½¿ç”¨ï¼ˆHTTP Methodsï¼‰
- âœ… GET - è·å–èµ„æº
- âœ… POST - åˆ›å»ºèµ„æº
- âœ… PUT - æ›´æ–°èµ„æº
- âœ… DELETE - åˆ é™¤èµ„æº

#### 3. HTTP çŠ¶æ€ç ï¼ˆStatus Codesï¼‰
- âœ… 200 - æˆåŠŸè·å–/æ›´æ–°/åˆ é™¤
- âœ… 201 - æˆåŠŸåˆ›å»º
- âœ… 400 - è¯·æ±‚éªŒè¯å¤±è´¥
- âœ… 401 - æœªè®¤è¯
- âœ… 403 - æ— æƒé™
- âœ… 404 - èµ„æºä¸å­˜åœ¨
- âœ… 409 - èµ„æºå†²çª

#### 4. å“åº”æ ¼å¼ï¼ˆResponse Formatï¼‰
- âœ… ç»Ÿä¸€ä½¿ç”¨ JSON
- âœ… é”™è¯¯å“åº”æ ¼å¼ç»Ÿä¸€
- âœ… åŒ…å«é€‚å½“çš„å…ƒæ•°æ®ï¼ˆåˆ†é¡µä¿¡æ¯ç­‰ï¼‰

---

## âš ï¸ ä¸ç¬¦åˆ RESTful è§„èŒƒçš„éƒ¨åˆ†

### é—®é¢˜ 1: è·¯å¾„å‚æ•°ä¸ä¸€è‡´ âŒ

**å½“å‰è®¾è®¡**:
```
GET /api/v1/domains/{domain}     # é€šè¿‡åŸŸåå­—ç¬¦ä¸²è·å–
GET /api/v1/domains/{id}      # é€šè¿‡ ID è·å–
PUT /api/v1/domains/{id}         # é€šè¿‡ ID æ›´æ–°
DELETE /api/v1/domains/{id}      # é€šè¿‡ ID åˆ é™¤
```

**é—®é¢˜**:
- `/domains/{domain}` å’Œ `/domains/id/{id}` è·¯å¾„å†²çª
- å¦‚æœåŸŸåæ˜¯ "id"ï¼Œä¼šäº§ç”Ÿæ­§ä¹‰
- ä¸ç¬¦åˆ RESTful çš„ç»Ÿä¸€æ¥å£åŸåˆ™

**RESTful æœ€ä½³å®è·µ**:
èµ„æºåº”è¯¥é€šè¿‡å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆé€šå¸¸æ˜¯ IDï¼‰è®¿é—®ï¼Œå¦‚æœéœ€è¦é€šè¿‡å…¶ä»–å­—æ®µæŸ¥è¯¢ï¼Œåº”è¯¥ä½¿ç”¨æŸ¥è¯¢å‚æ•°ã€‚

---

### é—®é¢˜ 2: GET è¯·æ±‚æ··åˆäº†ä¸¤ç§åŠŸèƒ½ âŒ

**å½“å‰è®¾è®¡**:
```
GET /api/v1/domains?url=baidu.com    # æŸ¥è¯¢å•ä¸ªåŸŸå
GET /api/v1/domains                  # è·å–åˆ—è¡¨
```

**é—®é¢˜**:
- åŒä¸€ä¸ªç«¯ç‚¹æ ¹æ®æŸ¥è¯¢å‚æ•°è¿”å›ä¸åŒç±»å‹çš„æ•°æ®ï¼ˆå•ä¸ªå¯¹è±¡ vs åˆ—è¡¨ï¼‰
- å“åº”æ ¼å¼ä¸ä¸€è‡´
- è¿åäº†å•ä¸€èŒè´£åŸåˆ™

**RESTful æœ€ä½³å®è·µ**:
- åˆ—è¡¨æŸ¥è¯¢å’Œå•ä¸ªèµ„æºæŸ¥è¯¢åº”è¯¥æ˜¯ä¸åŒçš„ç«¯ç‚¹
- æˆ–è€…ç»Ÿä¸€è¿”å›æ•°ç»„æ ¼å¼ï¼ˆå³ä½¿åªæœ‰ä¸€ä¸ªç»“æœï¼‰

---

### é—®é¢˜ 3: åˆ é™¤æ“ä½œè¿”å› 200 è€Œä¸æ˜¯ 204 âš ï¸

**å½“å‰è®¾è®¡**:
```
DELETE /api/v1/domains/{id}
Response: 200 { "message": "åŸŸååˆ é™¤æˆåŠŸ" }
```

**RESTful æœ€ä½³å®è·µ**:
- åˆ é™¤æˆåŠŸåº”è¯¥è¿”å› `204 No Content`ï¼ˆæ— å“åº”ä½“ï¼‰
- æˆ–è€…è¿”å› `200 OK` å¹¶åŒ…å«è¢«åˆ é™¤çš„èµ„æºä¿¡æ¯

---

### é—®é¢˜ 4: è®¤è¯ç«¯ç‚¹ä¸ç¬¦åˆ RESTful é£æ ¼ âš ï¸

**å½“å‰è®¾è®¡**:
```
POST /api/v1/auth/login
```

**é—®é¢˜**:
- `login` æ˜¯åŠ¨è¯ï¼Œä¸æ˜¯èµ„æº
- RESTful åº”è¯¥é¢å‘èµ„æºï¼Œè€Œä¸æ˜¯åŠ¨ä½œ

**RESTful æœ€ä½³å®è·µ**:
```
POST /api/v1/sessions      # åˆ›å»ºä¼šè¯ï¼ˆç™»å½•ï¼‰
DELETE /api/v1/sessions    # åˆ é™¤ä¼šè¯ï¼ˆç™»å‡ºï¼‰
```

æˆ–è€…ä½¿ç”¨ OAuth 2.0 æ ‡å‡†ï¼š
```
POST /api/v1/token         # è·å–ä»¤ç‰Œ
```

---

## ğŸ”§ æ”¹è¿›å»ºè®®

### æ–¹æ¡ˆ A: æœ€å°æ”¹åŠ¨æ–¹æ¡ˆï¼ˆæ¨èï¼‰

ä¿æŒå‘åå…¼å®¹ï¼Œåªä¿®å¤æœ€ä¸¥é‡çš„é—®é¢˜ã€‚

#### 1. ä¿®å¤è·¯å¾„å†²çª

**ä¿®æ”¹å‰**:
```
GET /api/v1/domains/{domain}     # é€šè¿‡åŸŸåè·å–
GET /api/v1/domains/{id}      # é€šè¿‡ ID è·å–
```

**ä¿®æ”¹å**:
```
GET /api/v1/domains/{id}                    # é€šè¿‡ ID è·å–ï¼ˆæ ‡å‡† RESTfulï¼‰
GET /api/v1/domains?domain=example.com      # é€šè¿‡åŸŸåæŸ¥è¯¢ï¼ˆæŸ¥è¯¢å‚æ•°ï¼‰
GET /api/v1/domains?url=example.com         # é€šè¿‡ URL æŸ¥è¯¢ï¼ˆä¿æŒå…¼å®¹ï¼‰
```

#### 2. ç»Ÿä¸€æŸ¥è¯¢æ¥å£

**ä¿®æ”¹å‰**:
```
GET /api/v1/domains?url=baidu.com    # è¿”å›å•ä¸ªå¯¹è±¡
GET /api/v1/domains                  # è¿”å›åˆ—è¡¨
```

**ä¿®æ”¹å**:
```
GET /api/v1/domains                          # è¿”å›åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
GET /api/v1/domains?domain=baidu.com         # è¿”å›åˆ—è¡¨ï¼ˆè¿‡æ»¤ï¼Œå¯èƒ½ 0 æˆ– 1 ä¸ªç»“æœï¼‰
GET /api/v1/domains/{id}                     # è¿”å›å•ä¸ªå¯¹è±¡
```

#### 3. ä¼˜åŒ–åˆ é™¤å“åº”

**ä¿®æ”¹å‰**:
```
DELETE /api/v1/domains/{id}
Response: 200 { "message": "åŸŸååˆ é™¤æˆåŠŸ" }
```

**ä¿®æ”¹å**:
```
DELETE /api/v1/domains/{id}
Response: 204 No Content
```

---

### æ–¹æ¡ˆ B: å®Œå…¨ RESTful é‡æ„æ–¹æ¡ˆ

å®Œå…¨ç¬¦åˆ RESTful è§„èŒƒï¼Œä½†ä¼šç ´åå‘åå…¼å®¹æ€§ã€‚

#### 1. èµ„æºè·¯å¾„è®¾è®¡

```
# Domains èµ„æº
GET    /api/v1/domains              # è·å–åŸŸååˆ—è¡¨ï¼ˆæ”¯æŒè¿‡æ»¤ï¼‰
POST   /api/v1/domains              # åˆ›å»ºåŸŸå
GET    /api/v1/domains/{id}         # è·å–å•ä¸ªåŸŸå
PUT    /api/v1/domains/{id}         # æ›´æ–°åŸŸå
PATCH  /api/v1/domains/{id}         # éƒ¨åˆ†æ›´æ–°åŸŸå
DELETE /api/v1/domains/{id}         # åˆ é™¤åŸŸå

# Configs èµ„æº
GET    /api/v1/configs              # è·å–é…ç½®åˆ—è¡¨
POST   /api/v1/configs              # åˆ›å»ºé…ç½®
GET    /api/v1/configs/{id}         # è·å–å•ä¸ªé…ç½®
PUT    /api/v1/configs/{id}         # æ›´æ–°é…ç½®
PATCH  /api/v1/configs/{id}         # éƒ¨åˆ†æ›´æ–°é…ç½®
DELETE /api/v1/configs/{id}         # åˆ é™¤é…ç½®

# è®¤è¯èµ„æºï¼ˆä¼šè¯ï¼‰
POST   /api/v1/sessions             # åˆ›å»ºä¼šè¯ï¼ˆç™»å½•ï¼‰
DELETE /api/v1/sessions             # åˆ é™¤ä¼šè¯ï¼ˆç™»å‡ºï¼‰
GET    /api/v1/sessions/current     # è·å–å½“å‰ä¼šè¯ä¿¡æ¯
```

#### 2. æŸ¥è¯¢å‚æ•°è®¾è®¡

```
# åˆ†é¡µ
GET /api/v1/domains?page=1&pageSize=20

# è¿‡æ»¤
GET /api/v1/domains?domain=example.com
GET /api/v1/domains?search=example

# æ’åº
GET /api/v1/domains?sort=createdAt&order=desc

# å­—æ®µé€‰æ‹©
GET /api/v1/domains?fields=id,domain,homepage

# å…³è”èµ„æº
GET /api/v1/domains?include=config
GET /api/v1/domains/{id}?include=config
```

#### 3. å“åº”æ ¼å¼ç»Ÿä¸€

```json
// åˆ—è¡¨å“åº”
{
  "data": [...],
  "meta": {
    "page": 1,
    "pageSize": 20,
    "total": 100,
    "totalPages": 5
  },
  "links": {
    "self": "/api/v1/domains?page=1",
    "first": "/api/v1/domains?page=1",
    "last": "/api/v1/domains?page=5",
    "next": "/api/v1/domains?page=2",
    "prev": null
  }
}

// å•ä¸ªèµ„æºå“åº”
{
  "data": {...}
}

// é”™è¯¯å“åº”
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "è¯·æ±‚æ•°æ®éªŒè¯å¤±è´¥",
    "details": [...]
  }
}
```

#### 4. HTTP æ–¹æ³•è¯­ä¹‰

- **GET**: å¹‚ç­‰ï¼Œæ— å‰¯ä½œç”¨ï¼Œå¯ç¼“å­˜
- **POST**: éå¹‚ç­‰ï¼Œåˆ›å»ºèµ„æº
- **PUT**: å¹‚ç­‰ï¼Œå®Œå…¨æ›¿æ¢èµ„æº
- **PATCH**: å¹‚ç­‰ï¼Œéƒ¨åˆ†æ›´æ–°èµ„æº
- **DELETE**: å¹‚ç­‰ï¼Œåˆ é™¤èµ„æº

#### 5. çŠ¶æ€ç ä½¿ç”¨

- **200 OK**: æˆåŠŸï¼ˆGET, PUT, PATCHï¼‰
- **201 Created**: åˆ›å»ºæˆåŠŸï¼ˆPOSTï¼‰ï¼Œå“åº”å¤´åŒ…å« `Location`
- **204 No Content**: åˆ é™¤æˆåŠŸï¼ˆDELETEï¼‰
- **400 Bad Request**: è¯·æ±‚æ ¼å¼é”™è¯¯
- **401 Unauthorized**: æœªè®¤è¯
- **403 Forbidden**: å·²è®¤è¯ä½†æ— æƒé™
- **404 Not Found**: èµ„æºä¸å­˜åœ¨
- **409 Conflict**: èµ„æºå†²çª
- **422 Unprocessable Entity**: è¯­ä¹‰é”™è¯¯ï¼ˆå¦‚ä¸šåŠ¡è§„åˆ™éªŒè¯å¤±è´¥ï¼‰
- **429 Too Many Requests**: è¯·æ±‚è¿‡äºé¢‘ç¹
- **500 Internal Server Error**: æœåŠ¡å™¨é”™è¯¯

---

## ğŸ¯ æ¨èå®æ–½æ–¹æ¡ˆ

### é˜¶æ®µ 1: ä¿®å¤ä¸¥é‡é—®é¢˜ï¼ˆç«‹å³å®æ–½ï¼‰

1. **ä¿®å¤è·¯å¾„å†²çª**
   - ç§»é™¤ `/domains/id/{id}` è·¯å¾„
   - å°† `/domains/{domain}` æ”¹ä¸ºæŸ¥è¯¢å‚æ•°æ–¹å¼
   - ä¿æŒ `/domains/{id}` ä½œä¸ºæ ‡å‡†è·¯å¾„

2. **ç»Ÿä¸€æŸ¥è¯¢æ¥å£**
   - GET `/domains` å§‹ç»ˆè¿”å›åˆ—è¡¨æ ¼å¼
   - ä½¿ç”¨æŸ¥è¯¢å‚æ•°è¿‡æ»¤ï¼š`?domain=xxx`
   - å•ä¸ªèµ„æºé€šè¿‡ `/domains/{id}` è·å–

3. **ä¼˜åŒ–åˆ é™¤å“åº”**
   - DELETE æ“ä½œè¿”å› 204 çŠ¶æ€ç 
   - ä¸è¿”å›å“åº”ä½“

### é˜¶æ®µ 2: å¢å¼ºåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

1. **æ·»åŠ  PATCH æ”¯æŒ**
   - æ”¯æŒéƒ¨åˆ†æ›´æ–°èµ„æº
   - ä¸ PUT åŒºåˆ†å¼€æ¥

2. **å¢å¼ºæŸ¥è¯¢èƒ½åŠ›**
   - æ”¯æŒæ›´å¤šè¿‡æ»¤å‚æ•°
   - æ”¯æŒæ’åº
   - æ”¯æŒå­—æ®µé€‰æ‹©

3. **æ”¹è¿›è®¤è¯ç«¯ç‚¹**
   - å°† `/auth/login` æ”¹ä¸º `/sessions`
   - æ›´ç¬¦åˆ RESTful é£æ ¼

### é˜¶æ®µ 3: ç‰ˆæœ¬ç®¡ç†ï¼ˆé•¿æœŸï¼‰

1. **å¼•å…¥ API ç‰ˆæœ¬**
   - å½“å‰ä¿æŒ `/api/v1/`
   - æ–°ç‰ˆæœ¬ä½¿ç”¨ `/api/v2/`
   - åœ¨ v2 ä¸­å®ç°å®Œå…¨ RESTful è®¾è®¡

2. **å‘åå…¼å®¹**
   - v1 ç»§ç»­æ”¯æŒæ—§å®¢æˆ·ç«¯
   - é€æ­¥è¿ç§»åˆ° v2
   - è®¾ç½® v1 åºŸå¼ƒæ—¶é—´è¡¨

---

## ğŸ“Š å¯¹æ¯”è¡¨æ ¼

| ç‰¹æ€§ | å½“å‰è®¾è®¡ | RESTful æœ€ä½³å®è·µ | ä¼˜å…ˆçº§ |
|------|---------|-----------------|--------|
| èµ„æºå‘½å | âœ… å¤æ•°åè¯ | âœ… å¤æ•°åè¯ | - |
| HTTP æ–¹æ³• | âœ… æ­£ç¡®ä½¿ç”¨ | âœ… æ­£ç¡®ä½¿ç”¨ | - |
| è·¯å¾„å‚æ•° | âŒ ä¸ä¸€è‡´ | âœ… ç»Ÿä¸€ä½¿ç”¨ ID | ğŸ”´ é«˜ |
| æŸ¥è¯¢å‚æ•° | âš ï¸ æ··åˆä½¿ç”¨ | âœ… æ¸…æ™°åˆ†ç¦» | ğŸŸ¡ ä¸­ |
| åˆ é™¤å“åº” | âš ï¸ 200 + body | âœ… 204 No Content | ğŸŸ¢ ä½ |
| è®¤è¯ç«¯ç‚¹ | âš ï¸ åŠ¨è¯å½¢å¼ | âœ… èµ„æºå½¢å¼ | ğŸŸ¢ ä½ |
| çŠ¶æ€ç  | âœ… åŸºæœ¬æ­£ç¡® | âœ… å®Œå…¨æ­£ç¡® | ğŸŸ¢ ä½ |
| å“åº”æ ¼å¼ | âš ï¸ ä¸å®Œå…¨ç»Ÿä¸€ | âœ… å®Œå…¨ç»Ÿä¸€ | ğŸŸ¡ ä¸­ |
| HATEOAS | âŒ ä¸æ”¯æŒ | âš ï¸ å¯é€‰ | ğŸŸ¢ ä½ |

---

## ğŸ’¡ å®æ–½å»ºè®®

### ç«‹å³ä¿®å¤ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

ä¿®å¤è·¯å¾„å†²çªé—®é¢˜ï¼Œè¿™æ˜¯æœ€ä¸¥é‡çš„ RESTful è¿è§„ï¼š

```typescript
// åˆ é™¤è¿™ä¸ªè·¯ç”±
router.get('/id/:id', ...)

// ä¿®æ”¹è¿™ä¸ªè·¯ç”±ä¸ºæŸ¥è¯¢å‚æ•°
router.get('/', async (req, res) => {
  const { domain, url, page, pageSize } = req.query;
  
  // å¦‚æœæä¾›äº† domain æˆ– url å‚æ•°ï¼Œè¿›è¡Œè¿‡æ»¤æŸ¥è¯¢
  if (domain || url) {
    const searchDomain = domain || url;
    const result = await domainService.findByDomain(searchDomain);
    // è¿”å›åˆ—è¡¨æ ¼å¼ï¼ˆå³ä½¿åªæœ‰ä¸€ä¸ªç»“æœï¼‰
    return res.json({
      data: result ? [result] : [],
      pagination: { page: 1, pageSize: 1, total: result ? 1 : 0, totalPages: 1 }
    });
  }
  
  // å¦åˆ™è¿”å›åˆ†é¡µåˆ—è¡¨
  const result = await domainService.list({ page, pageSize });
  res.json(result);
});

// ä¿æŒæ ‡å‡†çš„ ID è·¯ç”±
router.get('/:id', ...)
```

### æ¸è¿›æ”¹è¿›ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

1. ç»Ÿä¸€å“åº”æ ¼å¼
2. ä¼˜åŒ–åˆ é™¤æ“ä½œè¿”å› 204
3. æ·»åŠ æ›´å¤šæŸ¥è¯¢å‚æ•°æ”¯æŒ

### é•¿æœŸè§„åˆ’ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

1. å¼•å…¥ API v2
2. å®ç°å®Œå…¨ RESTful è®¾è®¡
3. æ·»åŠ  HATEOAS æ”¯æŒ

---

## ğŸ“š RESTful è®¾è®¡åŸåˆ™æ€»ç»“

1. **èµ„æºå¯¼å‘**: ä½¿ç”¨åè¯è€Œä¸æ˜¯åŠ¨è¯
2. **ç»Ÿä¸€æ¥å£**: ä½¿ç”¨æ ‡å‡† HTTP æ–¹æ³•
3. **æ— çŠ¶æ€**: æ¯ä¸ªè¯·æ±‚åŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯
4. **å¯ç¼“å­˜**: GET è¯·æ±‚åº”è¯¥å¯ç¼“å­˜
5. **åˆ†å±‚ç³»ç»Ÿ**: å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“æ˜¯å¦ç›´æ¥è¿æ¥åˆ°æœåŠ¡å™¨
6. **æŒ‰éœ€ä»£ç **: å¯é€‰ï¼ŒæœåŠ¡å™¨å¯ä»¥è¿”å›å¯æ‰§è¡Œä»£ç 

---

## ğŸ”— å‚è€ƒèµ„æº

- [RESTful API è®¾è®¡æŒ‡å—](https://restfulapi.net/)
- [Microsoft REST API Guidelines](https://github.com/microsoft/api-guidelines)
- [Google API Design Guide](https://cloud.google.com/apis/design)
- [HTTP çŠ¶æ€ç ](https://httpstatuses.com/)
