-- 回滚脚本: 恢复到单表设计
-- 版本: 002
-- 描述: 将双表设计回滚到原始的单表设计

-- ============================================================
-- 步骤 1: 重建原始的 domain 表（从备份恢复）
-- ============================================================
-- 如果 domain_backup 表存在，直接重命名回来
DROP TABLE IF EXISTS `domain`;
RENAME TABLE `domain_backup` TO `domain`;

-- ============================================================
-- 步骤 2: 删除新创建的表
-- ============================================================
-- 注意：必须先删除有外键约束的 domains 表
DROP TABLE IF EXISTS `domains`;
DROP TABLE IF EXISTS `configs`;

-- ============================================================
-- 验证回滚
-- ============================================================
SELECT COUNT(*) as domain_count FROM `domain`;

-- ============================================================
-- 注意事项
-- ============================================================
-- 1. 此脚本假设 domain_backup 表仍然存在
-- 2. 如果已删除 domain_backup，需要从其他备份恢复数据
-- 3. 回滚后会丢失迁移后的所有新数据
