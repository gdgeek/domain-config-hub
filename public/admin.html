<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸŸåé…ç½®ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 14px; }
        .version-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }
        .tabs {
            display: flex;
            background: #f9fafb;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab:hover { background: #f3f4f6; }
        .tab.active {
            background: white;
            border-bottom-color: #667eea;
            font-weight: 600;
        }
        .tab-content { display: none; padding: 30px; }
        .tab-content.active { display: block; }
        .toolbar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .search-box {
            flex: 1;
            max-width: 400px;
            margin-right: 20px;
        }
        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-small { padding: 6px 12px; font-size: 12px; }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background: #f9fafb;
            font-weight: 600;
        }
        tr:hover { background: #f9fafb; }
        .actions { display: flex; gap: 8px; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
        }
        .form-group textarea {
            min-height: 80px;
            font-family: 'Courier New', monospace;
        }
        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        .alert.show { display: block; }
        .alert-success { background: #d1fae5; color: #065f46; }
        .alert-error { background: #fee2e2; color: #991b1b; }
        .hidden { display: none; }
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="loginContainer" class="login-container">
        <h2 style="text-align: center; margin-bottom: 30px; color: #667eea;">ğŸ” ç®¡ç†å‘˜ç™»å½•</h2>
        <div id="loginAlert" class="alert alert-error"></div>
        <form id="loginForm">
            <div class="form-group">
                <label>ç®¡ç†å¯†ç </label>
                <input type="password" id="password" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å½•</button>
        </form>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div id="mainContainer" class="container hidden">
        <div class="header">
            <span class="version-badge">åŒè¡¨æ¶æ„</span>
            <button class="btn btn-secondary btn-small logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
            <h1>ğŸŒ åŸŸåé…ç½®ç®¡ç†ç³»ç»Ÿ</h1>
            <p>Domain Configuration Management System - Dual Table Architecture</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('configs')">ğŸ“‹ é…ç½®ç®¡ç†</div>
            <div class="tab" onclick="switchTab('domains')">ğŸŒ åŸŸåç®¡ç†</div>
        </div>
        
        <!-- é…ç½®ç®¡ç†æ ‡ç­¾é¡µ -->
        <div id="configsTab" class="tab-content active">
            <div id="configAlert" class="alert"></div>
            <div class="toolbar">
                <div class="search-box">
                    <input type="text" id="configSearch" placeholder="ğŸ” æœç´¢é…ç½®..." onkeyup="searchConfigs()">
                </div>
                <button class="btn btn-success" onclick="showCreateConfigModal()">â• æ·»åŠ é…ç½®</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>æ ‡é¢˜</th>
                        <th>ä½œè€…</th>
                        <th>æè¿°</th>
                        <th>å…³è”åŸŸåæ•°</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="configTableBody">
                    <tr><td colspan="6" style="text-align: center; padding: 40px;">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
        
        <!-- åŸŸåç®¡ç†æ ‡ç­¾é¡µ -->
        <div id="domainsTab" class="tab-content">
            <div id="domainAlert" class="alert"></div>
            <div class="toolbar">
                <div class="search-box">
                    <input type="text" id="domainSearch" placeholder="ğŸ” æœç´¢åŸŸå..." onkeyup="searchDomains()">
                </div>
                <button class="btn btn-success" onclick="showCreateDomainModal()">â• æ·»åŠ åŸŸå</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>åŸŸå</th>
                        <th>ä¸»é¡µ</th>
                        <th>é…ç½®ID</th>
                        <th>æ ‡é¢˜</th>
                        <th>ä½œè€…</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="domainTableBody">
                    <tr><td colspan="7" style="text-align: center; padding: 40px;">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- é…ç½®æ¨¡æ€æ¡† -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="configModalTitle">æ·»åŠ é…ç½®</h2>
                <button class="close-btn" onclick="closeConfigModal()">&times;</button>
            </div>
            <form id="configForm">
                <input type="hidden" id="configId">
                <div class="form-group">
                    <label>æ ‡é¢˜</label>
                    <input type="text" id="configTitle">
                </div>
                <div class="form-group">
                    <label>ä½œè€…</label>
                    <input type="text" id="configAuthor">
                </div>
                <div class="form-group">
                    <label>æè¿°</label>
                    <input type="text" id="configDescription">
                </div>
                <div class="form-group">
                    <label>å…³é”®è¯</label>
                    <input type="text" id="configKeywords">
                </div>
                <div class="form-group">
                    <label>é“¾æ¥é…ç½® (JSON)</label>
                    <textarea id="configLinks" placeholder='{"home": "https://example.com"}'></textarea>
                </div>
                <div class="form-group">
                    <label>æƒé™é…ç½® (JSON)</label>
                    <textarea id="configPermissions" placeholder='{"read": true, "write": false}'></textarea>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ä¿å­˜</button>
                    <button type="button" class="btn btn-secondary" onclick="closeConfigModal()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- åŸŸåæ¨¡æ€æ¡† -->
    <div id="domainModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="domainModalTitle">æ·»åŠ åŸŸå</h2>
                <button class="close-btn" onclick="closeDomainModal()">&times;</button>
            </div>
            <form id="domainForm">
                <input type="hidden" id="domainId">
                <div class="form-group">
                    <label>åŸŸå *</label>
                    <input type="text" id="domainName" placeholder="example.com" required>
                </div>
                <div class="form-group">
                    <label>ä¸»é¡µ URL</label>
                    <input type="url" id="domainHomepage" placeholder="https://example.com">
                    <small style="color: #666; font-size: 12px;">å¯é€‰ï¼ŒåŸŸåçš„ä¸»é¡µåœ°å€</small>
                </div>
                <div class="form-group">
                    <label>å…³è”é…ç½® *</label>
                    <select id="domainConfigId" required>
                        <option value="">è¯·é€‰æ‹©é…ç½®</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ä¿å­˜</button>
                    <button type="button" class="btn btn-secondary" onclick="closeDomainModal()">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let authToken = '';
        let allConfigs = [];
        let allDomains = [];

        // ç™»å½•
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('password').value;
            try {
                const response = await fetch('/api/v1/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify({ password })
                });
                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token || password;
                    localStorage.setItem('adminToken', authToken);
                    showMainContainer();
                    loadConfigs();
                    loadDomains();
                } else {
                    showLoginError('å¯†ç é”™è¯¯');
                }
            } catch (error) {
                authToken = password;
                localStorage.setItem('adminToken', authToken);
                showMainContainer();
                loadConfigs();
                loadDomains();
            }
        });

        function showLoginError(msg) {
            const alert = document.getElementById('loginAlert');
            alert.textContent = msg;
            alert.classList.add('show');
            setTimeout(() => alert.classList.remove('show'), 3000);
        }

        function showMainContainer() {
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('mainContainer').classList.remove('hidden');
        }

        function logout() {
            localStorage.removeItem('adminToken');
            location.reload();
        }

        window.addEventListener('load', () => {
            const token = localStorage.getItem('adminToken');
            if (token) {
                authToken = token;
                showMainContainer();
                loadConfigs();
                loadDomains();
            }
        });

        // æ ‡ç­¾åˆ‡æ¢
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        // åŠ è½½é…ç½®åˆ—è¡¨
        async function loadConfigs() {
            try {
                const url = '/api/v1/configs';
                console.log('æ­£åœ¨è¯·æ±‚:', url);
                console.log('å®Œæ•´ URL:', window.location.origin + url);
                
                const response = await fetch(url, {
                    headers: { 
                        'Authorization': `Bearer ${authToken}`,
                        'Accept': 'application/json'
                    },
                    cache: 'no-cache'
                });
                
                console.log('å“åº”çŠ¶æ€:', response.status);
                console.log('å“åº” Content-Type:', response.headers.get('content-type'));
                
                if (!response.ok) {
                    const text = await response.text();
                    console.error('é”™è¯¯å“åº”å†…å®¹:', text.substring(0, 200));
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                allConfigs = data.data || [];
                renderConfigTable(allConfigs);
            } catch (error) {
                console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                showAlert('configAlert', 'åŠ è½½é…ç½®å¤±è´¥: ' + error.message, 'error');
                // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œæ¸…é™¤ token å¹¶é‡æ–°ç™»å½•
                if (error.message.includes('401') || error.message.includes('403')) {
                    logout();
                }
            }
        }

        function renderConfigTable(configs) {
            const tbody = document.getElementById('configTableBody');
            if (configs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px;">æš‚æ— æ•°æ®</td></tr>';
                return;
            }
            tbody.innerHTML = configs.map(c => `
                <tr>
                    <td>${c.id}</td>
                    <td><strong>${c.title || '-'}</strong></td>
                    <td>${c.author || '-'}</td>
                    <td>${c.description || '-'}</td>
                    <td>-</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-small" onclick="editConfig(${c.id})">ç¼–è¾‘</button>
                        <button class="btn btn-danger btn-small" onclick="deleteConfig(${c.id})">åˆ é™¤</button>
                    </td>
                </tr>
            `).join('');
        }

        function searchConfigs() {
            const term = document.getElementById('configSearch').value.toLowerCase();
            const filtered = allConfigs.filter(c => 
                (c.title && c.title.toLowerCase().includes(term)) ||
                (c.author && c.author.toLowerCase().includes(term))
            );
            renderConfigTable(filtered);
        }

        // åŠ è½½åŸŸååˆ—è¡¨
        async function loadDomains() {
            try {
                const response = await fetch('/api/v1/domains', {
                    headers: { 
                        'Authorization': `Bearer ${authToken}`,
                        'Accept': 'application/json'
                    },
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                allDomains = data.data || [];
                renderDomainTable(allDomains);
            } catch (error) {
                console.error('åŠ è½½åŸŸåå¤±è´¥:', error);
                showAlert('domainAlert', 'åŠ è½½åŸŸåå¤±è´¥: ' + error.message, 'error');
                // å¦‚æœæ˜¯è®¤è¯é”™è¯¯ï¼Œæ¸…é™¤ token å¹¶é‡æ–°ç™»å½•
                if (error.message.includes('401') || error.message.includes('403')) {
                    logout();
                }
            }
        }

        function renderDomainTable(domains) {
            const tbody = document.getElementById('domainTableBody');
            if (domains.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">æš‚æ— æ•°æ®</td></tr>';
                return;
            }
            tbody.innerHTML = domains.map(d => `
                <tr>
                    <td>${d.id}</td>
                    <td><strong>${d.domain}</strong></td>
                    <td>${d.homepage ? `<a href="${d.homepage}" target="_blank" style="color: #667eea;">ğŸ”—</a>` : '-'}</td>
                    <td>${d.configId}</td>
                    <td>${d.config?.title || '-'}</td>
                    <td>${d.config?.author || '-'}</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-small" onclick="editDomain(${d.id})">ç¼–è¾‘</button>
                        <button class="btn btn-danger btn-small" onclick="deleteDomain(${d.id}, '${d.domain}')">åˆ é™¤</button>
                    </td>
                </tr>
            `).join('');
        }

        function searchDomains() {
            const term = document.getElementById('domainSearch').value.toLowerCase();
            const filtered = allDomains.filter(d => 
                d.domain.toLowerCase().includes(term) ||
                (d.config?.title && d.config.title.toLowerCase().includes(term))
            );
            renderDomainTable(filtered);
        }

        // é…ç½®CRUD
        function showCreateConfigModal() {
            document.getElementById('configModalTitle').textContent = 'æ·»åŠ é…ç½®';
            document.getElementById('configForm').reset();
            document.getElementById('configId').value = '';
            document.getElementById('configModal').classList.add('active');
        }

        async function editConfig(id) {
            try {
                const response = await fetch(`/api/v1/configs/${id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}`, 'Accept': 'application/json' }
                });
                const result = await response.json();
                const config = result.data;
                document.getElementById('configModalTitle').textContent = 'ç¼–è¾‘é…ç½®';
                document.getElementById('configId').value = config.id;
                document.getElementById('configTitle').value = config.title || '';
                document.getElementById('configAuthor').value = config.author || '';
                document.getElementById('configDescription').value = config.description || '';
                document.getElementById('configKeywords').value = config.keywords || '';
                document.getElementById('configLinks').value = config.links ? JSON.stringify(config.links, null, 2) : '';
                document.getElementById('configPermissions').value = config.permissions ? JSON.stringify(config.permissions, null, 2) : '';
                document.getElementById('configModal').classList.add('active');
            } catch (error) {
                showAlert('configAlert', 'åŠ è½½é…ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function deleteConfig(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤æ­¤é…ç½®å—ï¼Ÿ')) return;
            try {
                const response = await fetch(`/api/v1/configs/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}`, 'Accept': 'application/json' }
                });
                // 204 No Content è¡¨ç¤ºåˆ é™¤æˆåŠŸ
                if (!response.ok && response.status !== 204) throw new Error('åˆ é™¤å¤±è´¥');
                showAlert('configAlert', 'åˆ é™¤æˆåŠŸ', 'success');
                loadConfigs();
            } catch (error) {
                showAlert('configAlert', 'åˆ é™¤å¤±è´¥: ' + error.message, 'error');
            }
        }

        function closeConfigModal() {
            document.getElementById('configModal').classList.remove('active');
        }

        document.getElementById('configForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('configId').value;
            const formData = {
                title: document.getElementById('configTitle').value || null,
                author: document.getElementById('configAuthor').value || null,
                description: document.getElementById('configDescription').value || null,
                keywords: document.getElementById('configKeywords').value || null,
            };
            try {
                const linksText = document.getElementById('configLinks').value.trim();
                formData.links = linksText ? JSON.parse(linksText) : null;
            } catch (error) {
                showAlert('configAlert', 'é“¾æ¥é…ç½® JSON æ ¼å¼é”™è¯¯', 'error');
                return;
            }
            try {
                const permsText = document.getElementById('configPermissions').value.trim();
                formData.permissions = permsText ? JSON.parse(permsText) : null;
            } catch (error) {
                showAlert('configAlert', 'æƒé™é…ç½® JSON æ ¼å¼é”™è¯¯', 'error');
                return;
            }
            try {
                const url = id ? `/api/v1/configs/${id}` : '/api/v1/configs';
                const method = id ? 'PUT' : 'POST';
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json', 'Accept': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(formData)
                });
                if (!response.ok) throw new Error('æ“ä½œå¤±è´¥');
                showAlert('configAlert', id ? 'æ›´æ–°æˆåŠŸ' : 'åˆ›å»ºæˆåŠŸ', 'success');
                closeConfigModal();
                loadConfigs();
            } catch (error) {
                showAlert('configAlert', 'æ“ä½œå¤±è´¥: ' + error.message, 'error');
            }
        });

        // åŸŸåCRUD
        async function showCreateDomainModal() {
            await loadConfigsForSelect();
            document.getElementById('domainModalTitle').textContent = 'æ·»åŠ åŸŸå';
            document.getElementById('domainForm').reset();
            document.getElementById('domainId').value = '';
            document.getElementById('domainName').disabled = false;
            document.getElementById('domainModal').classList.add('active');
        }

        async function loadConfigsForSelect() {
            try {
                const response = await fetch('/api/v1/configs', {
                    headers: { 'Authorization': `Bearer ${authToken}`, 'Accept': 'application/json' }
                });
                const data = await response.json();
                const select = document.getElementById('domainConfigId');
                select.innerHTML = '<option value="">è¯·é€‰æ‹©é…ç½®</option>' + 
                    (data.data || []).map(c => `<option value="${c.id}">${c.title || `é…ç½® ${c.id}`}</option>`).join('');
            } catch (error) {
                console.error('åŠ è½½é…ç½®åˆ—è¡¨å¤±è´¥', error);
            }
        }

        async function editDomain(id) {
            await loadConfigsForSelect();
            try {
                const response = await fetch(`/api/v1/domains/id/${id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}`, 'Accept': 'application/json' }
                });
                const result = await response.json();
                const domain = result.data;
                document.getElementById('domainModalTitle').textContent = 'ç¼–è¾‘åŸŸå';
                document.getElementById('domainId').value = domain.id;
                document.getElementById('domainName').value = domain.domain;
                document.getElementById('domainName').disabled = true;
                document.getElementById('domainHomepage').value = domain.homepage || '';
                document.getElementById('domainConfigId').value = domain.configId;
                document.getElementById('domainModal').classList.add('active');
            } catch (error) {
                showAlert('domainAlert', 'åŠ è½½åŸŸåå¤±è´¥: ' + error.message, 'error');
            }
        }

        async function deleteDomain(id, domain) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤åŸŸå "${domain}" å—ï¼Ÿ`)) return;
            try {
                const response = await fetch(`/api/v1/domains/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}`, 'Accept': 'application/json' }
                });
                // 204 No Content è¡¨ç¤ºåˆ é™¤æˆåŠŸ
                if (!response.ok && response.status !== 204) throw new Error('åˆ é™¤å¤±è´¥');
                showAlert('domainAlert', 'åˆ é™¤æˆåŠŸ', 'success');
                loadDomains();
            } catch (error) {
                showAlert('domainAlert', 'åˆ é™¤å¤±è´¥: ' + error.message, 'error');
            }
        }

        function closeDomainModal() {
            document.getElementById('domainModal').classList.remove('active');
        }

        document.getElementById('domainForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('domainId').value;
            const homepage = document.getElementById('domainHomepage').value.trim();
            const formData = {
                domain: document.getElementById('domainName').value,
                configId: parseInt(document.getElementById('domainConfigId').value),
                homepage: homepage || null
            };
            try {
                const url = id ? `/api/v1/domains/${id}` : '/api/v1/domains';
                const method = id ? 'PUT' : 'POST';
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json', 'Accept': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(formData)
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'æ“ä½œå¤±è´¥');
                }
                showAlert('domainAlert', id ? 'æ›´æ–°æˆåŠŸ' : 'åˆ›å»ºæˆåŠŸ', 'success');
                closeDomainModal();
                loadDomains();
            } catch (error) {
                showAlert('domainAlert', 'æ“ä½œå¤±è´¥: ' + error.message, 'error');
            }
        });

        function showAlert(id, msg, type) {
            const alert = document.getElementById(id);
            alert.textContent = msg;
            alert.className = `alert alert-${type} show`;
            setTimeout(() => alert.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
